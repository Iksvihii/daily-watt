<div class="card">
  <h3>Dashboard</h3>
  <form class="grid two" (ngSubmit)="load()">
    <div>
      <label>From</label>
      <input type="datetime-local" [ngModel]="from()" (ngModelChange)="from.set($event)" name="from">
    </div>
    <div>
      <label>To</label>
      <input type="datetime-local" [ngModel]="to()" (ngModelChange)="to.set($event)" name="to">
    </div>
    <div>
      <label>Granularity</label>
      <select [ngModel]="granularity()" (ngModelChange)="granularity.set($event)" name="granularity">
        <option value="30min">30 minutes</option>
        <option value="hour">Hour</option>
        <option value="day">Day</option>
      </select>
    </div>
    <div style="display:flex;align-items:center;gap:8px;">
      <input type="checkbox" [ngModel]="withWeather()" (ngModelChange)="withWeather.set($event)" id="weather" name="weather">
      <label for="weather">Show temperature</label>
    </div>
    <button class="btn" type="submit" [disabled]="loading()">Load</button>
  </form>
  @if (error()) {
    <p class="status negative">{{ error() }}</p>
  }
</div>

@if (data()) {
  <div class="grid two">
    <div class="card">
      <div class="status">Total kWh</div>
      <div style="font-size:28px;font-weight:700;">{{ data()!.summary.totalKwh | number:'1.0-2' }}</div>
    </div>
    <div class="card">
      <div class="status">Average per day</div>
      <div style="font-size:28px;font-weight:700;">{{ data()!.summary.avgKwhPerDay | number:'1.0-2' }}</div>
    </div>
    <div class="card">
      <div class="status">Max day</div>
      <div style="font-size:28px;font-weight:700;">{{ data()!.summary.maxDayKwh | number:'1.0-2' }}</div>
      <div class="status">{{ data()!.summary.maxDay }}</div>
    </div>
  </div>

  <div class="chart-wrapper">
    <app-consumption-chart [consumption]="data()!.consumption" [weather]="withWeather() ? data()!.weather : undefined"></app-consumption-chart>
  </div>
}
